@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>

<html>
<head>
    <script type="text/javascript" src="@Url.Content("~/Scripts/ckeditor.js")"></script>
<div class ="bar"><span class="barText"><h2>Admin Options</h2></span></div>
 
    <style>
        #ddlGender{
            margin-left:42px;
            width:186px;
        }

        .btnNewImg{
            border: 2px solid black;
            width:150px;
            height:25px;
            text-align:center;
        }

        .btnDelete{
            border: 2px solid black;
            float:right;
            width:80px;
            height:25px;
            text-align:center;
        }

        .btnEdit{
            border: 2px solid black;
            float:right;
            margin-right:5px;
            width:80px;
            height:25px;
            text-align:center;
        }

        .btnSaveNew{
            border: 2px solid black;
            float:right;
            margin-right:3px;
            width:100px;
            height:25px;
        }

        .btnUpdate{
            border: 2px solid black;
            float:right;
            margin-right:3px;
            width:80px;
            height:25px;
            text-align:center;
        }

        .btnPageSave{
            float:right;
        }
    </style>

 <script type="text/javascript">

     $(document).ready(function () {
         CKEDITOR.replace('editor1', {
             height: '380px',
             width: '100%',
             resize_enabled: false,
             forcePasteAsPlainText: true
             //filebrowserImageUploadUrl: GetImgUploadPath(),
             //filebrowserBrowseUrl: GetImgBrowsePath(),
             //filebrowserWindowWidth: 800,
             //filebrowserWindowHeight: 600
         });
         CKEDITOR.replace('editor2', {
             height: '380px',
             width: '100%',
             resize_enabled: false,
             forcePasteAsPlainText: true
             //filebrowserImageUploadUrl: GetImgUploadPath(),
             //filebrowserBrowseUrl: GetImgBrowsePath(),
             //filebrowserWindowWidth: 800,
             //filebrowserWindowHeight: 600
         });
         CKEDITOR.instances.editor1.setData("");
         CKEDITOR.instances.editor2.setData("");
         GetCategories();
         SelectChangedCategories();
     });

     function SelectChangedCategories() {
         $("#ddlCategories").change(function () {
             var id = $("#ddlCategories").val();
             if (id != -1) {
                 if ($("#ddlCategories option:selected").text().toLowerCase().indexOf("kids") >= 0)
                 {
                     $("#linkTab1").html("Girls");
                     $("#linkTab2").html("Boys");
                     $("#linkTab1").css("display", "inline");
                     $("#linkTab2").css("display", "inline");
                 }
                 else if ($("#ddlCategories option:selected").text().toLowerCase().indexOf("gauchos") >= 0 || $("#ddlCategories option:selected").text().toLowerCase().indexOf("shoes") >= 0) {
                     $("#linkTab1").html("Women");
                     $("#linkTab2").css("display", "none");
                 }
                 else {
                     $("#linkTab1").html("Women");
                     $("#linkTab2").html("Men");
                     $("#linkTab1").css("display", "inline");
                     $("#linkTab2").css("display", "inline");
                 }
                 UpdateWomen();
                 UpdateMen();
             }
         });
     }

     function SelectChangedEditCategories() {
         $("#ddlEditCategories").change(function () {
             var id = $("#ddlEditCategories").val();
             if (id != -1) {
                 if ($("#ddlEditCategories option:selected").text().toLowerCase().indexOf("kids") >= 0) {
                     $("#ddlGender").empty().append(new Option('Girls', 'Girls'), new Option('Boys', 'Boys'));
                 }
                 else if ($("#ddlEditCategories option:selected").text().toLowerCase().indexOf("shoes") >= 0 || $("#ddlEditCategories option:selected").text().toLowerCase().indexOf("gauchos") >= 0) {
                     $("#ddlGender").empty().append(new Option('Women', 'Women'));
                 }
                 else {
                     $("#ddlGender").empty().append(new Option('Women', 'Women'), new Option('Men', 'Men'));
                 }
             }
         });
     }

     function GetCategories() {
         $("#ddlCategories").html("");
         $.ajax({
             type: "POST",
             cache: false,
             //this line needed to pass array
             traditional: true,
             url: "/Admin/LoadCategories",
             dataType: "json",
             async: false,
             success: function (data) {
                 var optionhtml = '<option value="' +
        -1 + '">----select section</option>';
                 $("#ddlCategories").append(optionhtml);
                 $(data).each(function (i) {
                     optionhtml = '<option value="' +
        data[i].ID + '">' + data[i].Name + '</option>';
                     $("#ddlCategories").append(optionhtml);
                 });
                 return true;
             }
         });
     }

     function GetEditCategories() {
         $("#ddlEditCategories").html("");
         $.ajax({
             type: "POST",
             cache: false,
             //this line needed to pass array
             traditional: true,
             url: "/Admin/LoadCategories",
             dataType: "json",
             async: false,
             success: function (data) {
                 var optionhtml = '<option value="' +
        -1 + '">----select section</option>';
                 $("#ddlEditCategories").append(optionhtml);
                 $(data).each(function (i) {
                     optionhtml = '<option value="' +
        data[i].ID + '">' + data[i].Name + '</option>';
                     $("#ddlEditCategories").append(optionhtml);
                 });
                 return true;
             }
         });
     }

     function UpdateWomen() {
         var id = $("#ddlCategories").val();
         if (id != -1) {
             $.ajax({
                 url: '@Url.Action("ReloadImgWomen", "Admin")',
                 data: { Folder: id },
                 type: 'POST',
                 success: function (data) {
                     $('#tabs-1').html(data);
                 }
             });
         }
     }

     function UpdateMen() {
         var id = $("#ddlCategories").val();
         if (id != -1) {
             $.ajax({
                 url: '@Url.Action("ReloadImgMen", "Admin")',
                 data: { Folder: id },
                 type: 'POST',
                 success: function (data) {
                     $('#tabs-2').html(data);
                 }
             });
         }
     }

     function DeleteImage(path) {
         $("#popupwindow").dialog({
             autoOpen: false,
             modal: true,
             show: "fade",
             height: "150",
             width: "300px",
             title: "Delete Image?",
             buttons: {
                 "Delete": function () {
                     $.ajax({
                         type: "POST",
                         cache: false,
                         async: false,
                         url: "/Admin/DeleteImage",
                         dataType: "json",
                         data: { path: path },
                         async: false,
                         success: function (data) {
                             if (data == "Successful") {
                                 UpdateWomen();
                                 UpdateMen();
                                 LoadSecondaryMsg('Deleted Successfully.');
                             }
                             else {
                                 LoadSecondaryMsg('Did not delete Successfully.');
                             }
                             $("#popupwindow").dialog("close");
                             return true;
                         }
                     });
                 },
                 "Cancel": function () {
                     $(this).dialog("close");
                 }
             }
         });
         $("#popupwindow").html("Do you want to delete this image?");
         $("#popupwindow").dialog("open");
         return true;
     }


     function NewImage() {
         $("#popupwindow").dialog({
             autoOpen: false,
             modal: true,
             height: "450",
             width: "500px",
             show: "fade",
             title: "New Image",
             buttons: {
                 //OK: function () { $(this).dialog("close"); }
             }
         });
         $("#popupwindow").html("<span style=\"float:right\">Hide<input type=\"checkbox\" id=\"chkHidden\"></span><br\><br\><div style=\"text-align:center\"><input type=\"file\" name=\"UploadPDF\" id=\"txtUploadFile\" /></div><br><br><div style=\"text-align:center\">Category:<select style=\"margin-left:30px\" id=\"ddlEditCategories\"></select><br\><br\>Description:<input style=\"margin-left:12px\" id=\"txtImgName\" type=\"textbox\" ><br\><br\>Gender:<select style=\"margin-left:42px;width:186px\" id=\"ddlGender\"><option>Women</option><option>Men</option><option>Girls</option><option>Boys</option></select></span><br><br><br><br><a href=\"javascript:;\" class=\"btnSaveNew\" onclick=\"if(UploadImage()==false) return false;\">Save</a>")
         GetEditCategories();
         $(document).ready(function () {
             SelectChangedEditCategories();
         });
         $("#popupwindow").dialog("open");
         return true;
     }

     function UploadImage() {
         var upload = $("#txtUploadFile").val();
         var folder = $("#ddlEditCategories option:selected").val();
         var description = $("#txtImgName").val();
         var gender = $("#ddlGender option:selected").text();
         var hidden = $("#chkHidden").is(':checked');
         var id = $("#ddlEditCategories").val();
         var formData = new FormData();
         var imagefile = document.getElementById("txtUploadFile").files[0];
         var fileName = document.getElementById("txtUploadFile").value;
         formData.append("1", imagefile);

         var split = fileName.split('\\');
         var filename = split[split.length - 1];
         var extension = filename.split('.');
         extension = extension[extension.length - 1];
         if (ValidateImageDb(filename) == true) {
             LoadSecondaryMsg('Image name already exists in database.');
             return false;
         }

         if (ValidateImageExtension(extension) == false)
         {
             LoadSecondaryMsg('Please upload image files only.');
             return false;
         }

         if (upload == "")
         {
             LoadSecondaryMsg("Please select an image first.");
             return false;
         }
         if (id == -1) {
             LoadSecondaryMsg("Please select category.");
             return false;
         }
         if (description == "") {
             LoadSecondaryMsg("Please enter description.");
             return false;
         }

         $("#popupwindow2").dialog({
             autoOpen: false,
             modal: true,
             show: "fade",
             title: "Upload Image?",
             buttons: {
                 "Upload": function () {
                     $.ajax({
                         type: "POST",
                         url: "/Admin/UploadImage?description=" + description + "&gender=" + gender + "&folder=" + folder + "&hidden=" + hidden,
                         contentType: false,
                         processData: false,
                         data: formData,
                         async: false,
                         success: function (data) {
                             if (data == "Successful") {
                                 LoadSecondaryMsg("Uploaded Successfully.");
                                 UpdateWomen();
                                 UpdateMen();
                             }
                             else {
                                 LoadSecondaryMsg("Upload Failed.");
                             }
                             $("#popupwindow").dialog("close");
                             return true;
                         }
                     });
                 },
                 "Cancel": function () {
                     $(this).dialog("close");
                 }
             }
         });
         $("#popupwindow2").html("Do you want to upload this image?");
         $("#popupwindow2").dialog("open");
         return true;
     }

     function EditImage(path)
     {
         var filename = null;
         var description = null;
         var gender = null;
         var folder = null;
         var hidden = null;
         $.ajax({
             type: "POST",
             url: "/Admin/GetImgInfo",
             dataType: "json",
             data: { path: path },
             async: false,
             success: function (data) {
                 $(data).each(function (i) {
                     filename = data[i].ImageFileName;
                     description = data[i].ImageDescription;
                     gender = data[i].ImageGender;
                     folder = data[i].ImageFolder;
                     hidden = data[i].ImageHidden;
                 });
             }
         });

         $("#popupwindow").dialog({
             autoOpen: false,
             modal: true,
             height: "500",
             width: "500px",
             show: "fade",
             title: "Edit Image",
             buttons: {
                 //OK: function () { $(this).dialog("close"); }
             }
         });
         //$('#popupwindow').css('overflow', 'hidden');
         $("#popupwindow").html("<span style=\"float:right\">Hide<input type=\"checkbox\" id=\"chkHidden\"></span><br\><br\><div style=\"text-align:center\"><img src=\"" + path + "\" width=\"50%\" /></div><br><br><div style=\"text-align:center\">Category:<select style=\"margin-left:30px\" id=\"ddlEditCategories\"></select><br\><br\>Description:<input style=\"margin-left:12px\" id=\"txtImgName\" type=\"textbox\" ><br\><br\>Gender:<select id=\"ddlGender\"></select></span><br><br><br><br><a href=\"javascript:;\" class=\"btnUpdate\" onclick=\"UpdateImgInfo(\'" + path + "\');\">Update</a> ")
         GetEditCategories();
         $(document).ready(function () {
             if (folder.toLowerCase().indexOf("kids") >= 0) {
                 $("#ddlGender").empty().append(new Option('Girls', 'Girls'), new Option('Boys', 'Boys'));
             }
             else if (folder == "Shoes" || folder == "Gauchos")
             {
                 $("#ddlGender").empty().append(new Option('Women', 'Women'));
             }
             else
             {
                 $("#ddlGender").empty().append(new Option('Women', 'Women'), new Option('Men', 'Men'));
             }
             $("#ddlGender").val(gender);
         });
         SelectChangedEditCategories();
         $("#txtImgName").val(description);
         
         $("#ddlEditCategories").val(folder);
         if (hidden == 0)
         {
             $("#chkHidden").attr('checked', false);
         }
         else
         {
             $("#chkHidden").attr('checked', true);
         }
         $("#popupwindow").dialog("open");
         return true;
     }

     
     function UpdateImgInfo(path) {
         var folder = $("#ddlEditCategories option:selected").val();
         var description = $("#txtImgName").val();
         var gender = $("#ddlGender option:selected").text();
         var hidden = $("#chkHidden").is(':checked');
         var exist = false;
         var split = path.split('/');
         var newPath = "/" + folder + "/" + split[split.length - 1];
         if (ValidateImage(newPath) == true) {
             exist = true;
         }

         $("#popupwindow2").dialog({
             autoOpen: false,
             modal: true,
             show: "fade",
             title: "Update Image Info?",
             buttons: {
                 "Update": function () {
                     $.ajax({
                         type: "POST",
                         cache: false,
                         async: false,
                         url: "/Admin/UpdateImgInfo",
                         dataType: "json",
                         data: { path: path, description: description, gender: gender, folder: folder, hidden: hidden, imgExist: exist },
                         async: false,
                         success: function (data) {
                             if (data == "Successful") {
                                 LoadSecondaryMsg('Updated Successfully.');
                                 UpdateWomen();
                                 UpdateMen();
                             }
                             else {
                                 LoadSecondaryMsg('Did not update Successfully.');
                             }
                             $("#popupwindow").dialog("close");
                             return true;
                         }
                     });
                 },
                 "Cancel": function () {
                     $(this).dialog("close");
                 }
             }
         });
         $("#popupwindow2").html("Do you want to update this image's info?");
         $("#popupwindow2").dialog("open");
         return true;
     }

     function ValidateImage(path)
     {
         var exist = false;
         $.ajax({
             type: "POST",
             url: "/Admin/ValidateImage",
             dataType: "json",
             data: { path: path },
             async: false,
             success: function (data) {
                 if (data == "Exist")
                 {
                     exist = true;
                 }
             }
         });
         return exist;
     }

     function ValidateImageDb(filename) {
         var exist = false;
         $.ajax({
             type: "POST",
             url: "/Admin/ValidateImageDb",
             dataType: "json",
             data: { filename: filename },
             async: false,
             success: function (data) {
                 if (data == "Exist") {
                     exist = true;
                 }
             }
         });
         return exist;
     }

     function ValidateImageExtension(extension) {
         if (extension.toLowerCase().indexOf("jpg") >= 0 || extension.toLowerCase().indexOf("jpeg") >= 0 || extension.toLowerCase().indexOf("png") >= 0 || extension.toLowerCase().indexOf("gif") >= 0)
         {
             return true;
         }
         return false;
     }

     function UpdateView(tab, path, desc) {
         if (tab == "tabs-1") {
             $('#' + tab).html('<div class=\"LoadedImg\"> <a href="javascript:;" onclick="UpdateWomen(); ">Go back</a><br> <br><img id=\"imgSingle\" src="' + path + '" width=100% /> <br> <br><a href=\"javascript:;\" class=\"btnDelete\" onclick=\"DeleteImage(\'' + path + '\');\">Delete</a><a href=\"javascript:;\" class=\"btnEdit\" onclick=\"EditImage(\'' + path + '\');\">Edit</a><a href="javascript:;" onclick="UpdateWomen(); ">Go back</a> </div> <div class=\"LoadedImgDesc\">' + desc + '</div> ');
         }
         else {
             $('#' + tab).html('<div class=\"LoadedImg\"> <a href="javascript:;" onclick="UpdateMen(); ">Go back</a><br> <br><img src="' + path + '" width=100% /> <br> <br><a href=\"javascript:;\" class=\"btnDelete\" onclick=\"DeleteImage(\'' + path + '\');\">Delete</a><a href=\"javascript:;\" class=\"btnEdit\" onclick=\"EditImage(\'' + path + '\');\">Edit</a><a href="javascript:;" onclick="UpdateMen(); ">Go back</a> </div> <div class=\"LoadedImgDesc\">' + desc + '</div> ');
         }
     }

     $(function () {

         $("#tab1").on("click", function () {
             UpdateMen();
         });
         $("#tab2").on("click", function () {
             UpdateWomen();
         });
         $("#tabs").tabs({
 
         });

         $("#mainTabs").tabs({

         });
         $("#Maintab1").on("click", function () {

         });
         $("#Maintab2").on("click", function () {
 
         });

         $("#articleTabs").tabs({

         });
         $("#homeTab1").on("click", function () {

         });
         $("#aboutUsTab1").on("click", function () {

         });

         //         $("#tabs").tabs().css({
         //             'height': '660px',
         //             'overflow': 'auto',
         //             'font-size': '10pt'
         //         });
     });

</script>
</head>
<body>
<br />
    <div id="mainTabs">
        <ul>
            <li id="Maintab1"><a id="mainLinkTab1" href="#mainTabs-1">Images</a></li>
            <li id="Maintab2"><a id="mainLinkTab2" href="#mainTabs-2">Edit Pages</a></li>
        </ul>
        <div id="mainTabs-1">
            <div id="tabs">
                <br />
                <label>Load Section:</label><br />
                <select id="ddlCategories"></select>
                <a href="javascript:;" class="btnNewImg" onclick="NewImage()">Upload New Image</a>
                <br />
                <br />
                <ul>
                    <li id="tab1"><a id="linkTab1" href="#tabs-1">Women</a></li>
                    <li id="tab2"><a id="linkTab2" href="#tabs-2">Men</a></li>
                </ul>
                <div id="tabs-1">
                    @*@Html.Partial("_AllImgWomen")*@
                </div>
                <div id="tabs-2">
                    @*@Html.Partial("_AllImgMen")*@
                </div>
            </div>
        </div>
        <div id="mainTabs-2">
            <div id="articleTabs">
                <ul>
                    <li id="homeTab1"><a id="linkTab1" href="#homeTab">Home</a></li>
                    <li id="aboutUsTab1"><a id="linkTab2" href="#aboutUsTab">About Us</a></li>
                </ul>
                <div id="homeTab">
                    <div class="editor-field">
                        @Html.TextArea("editor1", new { @Id = "editor1" })
                    </div>
                    <a href="javascript:;" class="btnPageSave" onclick="SavePage('Home')">Save</a>
                </div>
                <div id="aboutUsTab">
                    <div class="editor-field">
                        @Html.TextArea("editor2", new { @Id = "editor2" })
                    </div>
                    <a href="javascript:;" class="btnPageSave" onclick="SavePage('AboutUs')">Save</a>
                </div>
            </div>
        </div>
     </div>
</body>
</html>
