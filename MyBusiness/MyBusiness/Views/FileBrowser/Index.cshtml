@using MyBusiness.Models
@using System.Web;
@using System.Web.Mvc;
@{
    Layout = null;
    string path = Server.MapPath("~");
    string[] splitPath = path.Split('\\');
    path = splitPath[0];
    var media = new DirectoryInfo(path + "//MBR0282-CoastalFlow//siteimages/");

}
<html>
<head>
    <title>Media Browser</title>
    <link href="../Content/Site.css" rel="stylesheet" type="text/css" />
    <script src="../ckeditor/ckeditor.js" type="text/javascript"></script>
    @*<script src="/Scripts/jquery.js"" type="text/javascript"></script>*@
    <script src="../Scripts/jquery-1.5.1.min.js" type="text/javascript"></script>
    <script src="../Scripts/jquery-ui-1.8.11.min.js" type="text/javascript"></script>
    <script src="../Scripts/jquery.validate.min.js" type="text/javascript"></script>
    <script src="../Scripts/jquery.validate.unobtrusive.min.js" type="text/javascript"></script>


    <script type="text/javascript">

        function GetPath() {
        var urlpath = "";
        var environ = window.location.host;
        if (environ.indexOf("localhost") != -1 || environ.indexOf("cfmdev1") != -1) {
            urlpath = "/ImageViewer/";
        }
        else {
            urlpath = "/ImageViewer/";
        }
        return urlpath;
    }

        var funcNum = @(Request["CKEditorFuncNum"] + ";")
        $(document).ready(function () {
            var title = null;
            //                $('li').click(function() {
            //                    $('#fileExplorer').load("/Images/ImageViewer?directory=" + encodeURIComponent($(this).text()));
            $.ajax({
                url: "/FileBrowser/GetImages",
                type: "POST",
                cache: false,
                async: true,
                //data: {value: encodeURIComponent($(this).text())},
                success: function (html) {
                    $('#fileExplorer').html(html);
                    title = html;
                    title.sub
                }
            });
            //                }).hover(function() {
            //                    $(this).css('cursor', 'pointer');
            //                });
            $('img').live('click', 'img', function () {
                var fileUrl = $(this).attr('title');
                window.opener.CKEDITOR.tools.callFunction(funcNum, fileUrl);
                window.close();
            }).hover(function () {
                $(this).css('cursor', 'pointer');
            });
        });
    </script>
</head>
<body>
    <div id="folderExplorer">
        @*           <ul>
            @foreach (var dir in media.EnumerateDirectories().Where(d => d.GetFilesByExtensions(".png", ".gif", ".jpg").Any()))
            {
                <li>@dir.Name</li>
            }
            </ul>*@
    </div>
    <div id="fileExplorer"></div>
</body>
</html>